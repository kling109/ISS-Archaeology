# ISS-Archaeology
## A repository for the CPSC 393 ISS Archeology Project

- To demo model: From the Facial_Recognition_Model subdirectory, run `python3 Main.py`
- To use model in code: Add `from Main_Model import Master_Model` to top of .py file (file must be located in Facial_Recognition_Model folder) and initialize an instance of `Master_Model` and call :
```
    model = Master_Model(train_dir, astro_pickle_dir, num_threads = 1)
    results = model.findFacesDir(test_dir)
```
  - Where:
    - train_dir:str = directory containing pictures of all astronauts to be added to model. Picture files must follow the following naming convention: `<first name>_[<middle name>_]<last name>&<nationality>.jpg`

    - astro_pickle_dir:str = Directory in which face_recognition model objects will be flattened and saved as .dat files. Note that any .dat files in this directory will be added to model

    - num_threads:int = Number of threads to be used by the model during training and analysis
    - test_dir = directory of jpg files in which to look for astronauts
  - Note that the return value of Master_Model.findFacesDir is an instance variable of the Master_Model class (Master_Model.found_faces) and will therefore be updated by repeated calls to findFacesDir. Entries in found_faces generated by previous calls to findFacesDir will NOT be deleted by any subsequent calls, and this will be reflected in the return value of findFacesDir.
- To run market-basket analysis on the output from Main_Model, use the .ipynb file Facial_Data_Generation.ipynb located in the Facial_Recognition_Model subdirectory.

## Scripts
### Flickr API
To user the `flickriss.py` module, follow the steps in the tutorial [here](https://github.com/alexis-mignon/python-flickr-api/wiki/Flickr-API-Keys-and-Authentication).

### classification.html
An html page with embeded javascript that we used as a tool for classing the astronauts' sex as `m` or `f`. We didn't end up using the result.
- Press `m` to mark the astronaut as male
- Press `n` to mark the astronaut as female
- Press `space` to print the output to the console (since javascript can't save to a file)
- Press `u` to undo the last action (not fully implimented because it ended up not being needed)

### Facial_Recognition_Model
**This information needs to be filled out still**
- Say something about how our program works by creating one model per astronaut

## Files
### astroSex.csv
A csv file that holds astronaut names and the sex assigned to them (did not end up being used in the analysis)

### cropped_Astronaut_photos/*.jpg
A dataset of cropped versions of the `ISS_Astronaut_photos/*.jpg` dataset. This was originally going to be used to reduce the training time of the models, but then we realized that we could use `pickle` to serialize the model data instead. Now we're saving it for future projects in case they want smaller files to train their model on.

The nameing convention is the same as `ISS_Astronaut_photos/*.jpg`, but `cropped_` was added to the bedinning of every filename.

### ISS_Astronaut_photos/*.jpg
A dataset manually built by Matt, Trevor, and Daniel from NASA's website. the naming convention for each file is `<first_name>_<last_name>&<country>.jpg`. The `country` tag was added to simplify the process of classifying astronauts by country.

## Classes
### Astro.py
A class to allow easy model-training, data-saving, data-loading, and model classification for each astronaut.
#### Variables
- `self.fName`: `str`, no default, represents the astronaut's first name
- `self.lName`: `str`, no default, represents the astronaut's last name
- `self.mName`: `str`, defaults to `""`, represents the astronaut's middle name
- `self.country`: `str`, no default, represents the astronaut's host country
- `self.facialData`: `face_encoding`, defaults to `None`, holds the trained model
- `self.filename`: `str`, defaults to `"{0}_{1}&{2}".format(fName, lName, country)`, Is the filename of the astronaut's data
  - This variable is no longer needed, as all astronauts are saved into one file. We originally thought the encodings were going to be much larger than they were and that we were going to need to load and unload the astronauts individually, but the encodings were so small that we decided to save all of the astronauts in one file.
#### Functions
`__init__(self, country: str, fName : str, lName : str, mName  = "")`
- Initializes the astronaut object
- No return value

`trainModel(self, imageFilepath, lock:mp.Lock)`
- Trains the face encodings based on a file, provided by a filepath
- No return value

`saveData(self, filePath = "")`
- Serializes the astronaut to a binary file using pickle
- No return value

`loadData(self, filePath = "")`
- Loads the astronaut's information from a binary file provided the filepath
- No return value

`checkFace(self, listOfAstronauts)`
- Searches for matches when given a list of astronaut facial encodings from a photo
- Returns an array of the found astronauts

`faceDistance(self, listOfAstronauts)`
- Finds the euclidian distance between `self.facialData` and a list of astronaut facial encodings from a photo
- Returns an array of distances

## JsonFlags.py only in GregoryBranch
it gets an OS error thats states:  
OSError: [Errno 24] Too many open files  
in order to run this code the test directory needs  
the pictures from the Dropbox or Flickr

# Things to Figure Out
- What is the `test` folder for?
- What is the `foobar` folder supposed to do?

